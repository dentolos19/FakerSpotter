@page "/finish"

@if (IsLocked)
{
    <Alert Color="Color.Danger" Visible="true">
        <AlertMessage>Locked</AlertMessage>
        <AlertDescription>This page is locked until you've completed all the rooms.</AlertDescription>
    </Alert>
    return;
}

<Animate Animation="Animations.Fade" Duration="TimeSpan.FromSeconds(2)">
    <Container TextAlignment="TextAlignment.Center">
        <Title Size="3" TextAlignment="TextAlignment.Center">Congratulations!</Title>
        <Figure Size="FigureSize.Is256x256">
            <FigureImage Source="@RewardImageUrl"/>
            <FigureCaption>
                <Paragraph>You've accumulated <b>@UserSettings.PointsAccumulated</b> points!</Paragraph>
                <Paragraph>You have been awarded with <b>@RewardText</b>!</Paragraph>
            </FigureCaption>
        </Figure>
        <Paragraph Margin="Margin.Is4.FromTop">
            Please give a feedback of your experience by clicking <a href="https://docs.google.com/forms/d/e/1FAIpQLSfFt_EQeDqJ2KfOlvpIujcnee6aGIzaIRujXpkY7Z3ZOGE5Yw/viewform?usp=sf_link">here</a>
        </Paragraph>
        <Button Color="Color.Primary" Clicked="OnRestart">Restart</Button>
    </Container>
</Animate>

@code
{

    [Inject] private IAnalytics Analytics { get; set; }
    [Inject] private NavigationManager NavigationManager { get; set; }

    private bool IsLocked => !(UserSettings.IsRoomOneCompleted
                               && UserSettings.IsRoomTwoCompleted
                               && UserSettings.IsRoomThreeCompleted);

    private string RewardImageUrl { get; set; }
    private string RewardText { get; set; }

    protected override void OnInitialized()
    {
        if (IsLocked)
            return;
        var points = UserSettings.PointsAccumulated;
        switch (points)
        {
            case >= 800:
                Analytics.TrackEvent("obtained_champion", points);
                RewardImageUrl = "assets/images/awards/champion.svg";
                RewardText = "Cyberwellness Champion";
                break;
            case >= 600:
                Analytics.TrackEvent("obtained_master", points);
                RewardImageUrl = "assets/images/awards/master.svg";
                RewardText = "Cyberwellness Master";
                break;
            case >= 400:
                Analytics.TrackEvent("obtained_apprentice", points);
                RewardImageUrl = "assets/images/awards/apprentice.svg";
                RewardText = "Cyberwellness Apprentice";
                break;
            default:
                Analytics.TrackEvent("obtained_novice", points);
                RewardImageUrl = "assets/images/awards/novice.svg";
                RewardText = "Cyberwellness Novice";
                break;
        }
    }

    private void OnRestart()
    {
        UserSettings.IsRoomOneCompleted = false;
        UserSettings.IsRoomTwoCompleted = false;
        UserSettings.IsRoomThreeCompleted = false;
        UserSettings.PointsAccumulated = 0;
        NavigationManager.NavigateTo("");
    }

}